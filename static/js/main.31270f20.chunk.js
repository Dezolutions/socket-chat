(this["webpackJsonpnorm-shat"]=this["webpackJsonpnorm-shat"]||[]).push([[0],{117:function(e,a,s){},118:function(e,a,s){},119:function(e,a,s){"use strict";s.r(a);var t=s(0),n=s.n(t),c=s(56),r=s.n(c),o=(s(63),s(7)),i=s(16),l=s.n(i),u=s(21),j=s(13),m=s(23),d=s.n(m),O=(s(26),s(121)),b=s(122),p=(s(82),s(2));var h=function(e){var a=e.onLogin,s=n.a.useState(""),t=Object(j.a)(s,2),c=t[0],r=t[1],o=n.a.useState(""),i=Object(j.a)(o,2),m=i[0],h=i[1],x=n.a.useState(!1),N=Object(j.a)(x,2),f=N[0],v=N[1],E=function(){var e=Object(u.a)(l.a.mark((function e(){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m&&c){e.next=4;break}alert("\u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"),e.next=9;break;case 4:return s={roomId:c,userName:m},v(!0),e.next=8,d.a.post("/rooms",s);case 8:a(s);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"join",children:Object(p.jsxs)(O.a,{className:"join-form",children:[Object(p.jsx)("p",{className:"jois-title",children:"chat on ReactJs + Express + Socket.io"}),Object(p.jsxs)(O.a.Group,{children:[Object(p.jsx)(O.a.Control,{value:c,onChange:function(e){r(e.target.value)},className:"join-input",type:"text",placeholder:"Room ID"}),Object(p.jsx)(O.a.Control,{value:m,onChange:function(e){h(e.target.value)},className:"join-input",type:"text",placeholder:"User Name"})]}),Object(p.jsx)(b.a,{disabled:f,onClick:E,variant:"success",children:f?"\u0412\u0445\u043e\u0434...":"\u0412\u043e\u0439\u0442\u0438"})]})})},x=s(57),N=s.n(x)()();s(117);var f=function(e){var a=e.users,s=e.messages,t=e.userName,c=e.roomId,r=e.onAddMessage,o=n.a.useState(""),i=Object(j.a)(o,2),l=i[0],u=i[1],m=n.a.useRef(null);return n.a.useEffect((function(){m.current.scrollTo(0,99999)}),[s]),Object(p.jsx)("div",{className:"chat__wrapper",children:Object(p.jsxs)("div",{className:"chat",children:[Object(p.jsxs)("div",{className:"chat-users",children:[Object(p.jsxs)("p",{className:"chat-room",children:["\u041a\u043e\u043c\u043d\u0430\u0442\u0430: ",Object(p.jsx)("strong",{children:c})," "]}),Object(p.jsxs)("p",{className:"chat-online",children:["\u041e\u043d\u043b\u0430\u0439\u043d(",a.length,")"]}),Object(p.jsx)("ul",{children:a.map((function(e,a){return Object(p.jsx)("li",{className:"online-user",children:e},e+a)}))})]}),Object(p.jsxs)("div",{className:"chat-messages",children:[Object(p.jsx)("div",{ref:m,className:"messages-block",children:s.map((function(e){return Object(p.jsx)("div",{className:"message",children:Object(p.jsxs)("div",{className:"message-inner",children:[Object(p.jsx)("p",{className:"message-name",children:e.userName}),Object(p.jsx)("p",{className:"message-text",children:e.text})]})})}))}),Object(p.jsxs)("div",{className:"form",children:[Object(p.jsx)(O.a.Control,{as:"textarea",onKeyPress:function(e){l&&(e.key="Enter")&&(N.emit("ROOM:NEW_MESSAGE",{userName:t,roomId:c,text:l}),r({userName:t,text:l}),u(""))},value:l,onChange:function(e){u(e.target.value)},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",className:"message-input",rows:3}),Object(p.jsx)(b.a,{onClick:function(){l&&(N.emit("ROOM:NEW_MESSAGE",{userName:t,roomId:c,text:l}),r({userName:t,text:l}),u(""))},type:"button",className:"message-btn",variant:"primary",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})]})]})})},v=s(58),E=function(e,a){switch(a.type){case"JOINED":return Object(o.a)(Object(o.a)({},e),{},{joined:!0,roomId:a.payload.roomId,userName:a.payload.userName});case"SET_USERS":return Object(o.a)(Object(o.a)({},e),{},{users:a.payload});case"SET_DATA":return Object(o.a)(Object(o.a)({},e),{},{users:a.payload.users,messages:a.payload.messages});case"NEW_MESSAGE":return Object(o.a)(Object(o.a)({},e),{},{messages:[].concat(Object(v.a)(e.messages),[a.payload])});default:return e}},g=s(120);s(118);var S=function(){var e=n.a.useReducer(E,{joined:!1,roomId:null,userName:null,users:[],messages:[]}),a=Object(j.a)(e,2),s=a[0],t=a[1],c=function(){var e=Object(u.a)(l.a.mark((function e(a){var s,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"JOINED",payload:a}),N.emit("ROOM:JOIN",a),e.next=4,d.a.get("/rooms/".concat(a.roomId));case 4:s=e.sent,n=s.data,t({type:"SET_DATA",payload:n});case 7:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),r=function(e){t({type:"SET_USERS",payload:e})},i=function(e){t({type:"NEW_MESSAGE",payload:e})};return n.a.useEffect((function(){N.on("ROOM:SET_USERS",r),N.on("ROOM:NEW_MESSAGE",i)}),[]),console.log(s),Object(p.jsx)(g.a,{children:Object(p.jsx)("div",{className:"app",children:s.joined?Object(p.jsx)(f,Object(o.a)(Object(o.a)({},s),{},{onAddMessage:i})):Object(p.jsx)(h,{className:"join",onLogin:c})})})};r.a.render(Object(p.jsx)(n.a.StrictMode,{children:Object(p.jsx)(S,{})}),document.getElementById("root"))},63:function(e,a,s){},82:function(e,a,s){}},[[119,1,2]]]);
//# sourceMappingURL=main.31270f20.chunk.js.map